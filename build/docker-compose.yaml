version: "3.2"
services:
  onos-ran-mlb:
    image: onosproject/onos-ran-mlb:latest
    hostname: onos-ran-mlb
    entrypoint: onos-ran-mlb
    command: -onosranaddr=onos-ran:5150 -threshold=1
  onos-ran-ho:
    image: onosproject/onos-ran-ho:latest
    hostname: onos-ran-ho
    entrypoint: onos-ran-ho
    command: -onosranaddr=onos-ran:5150
  onos-ran:
    image: onosproject/onos-ran:latest
    hostname: onos-ran
    volumes:
      - type: bind
        source: ./ran-simulator/certs
        target: /etc/ssl/certs
    ports:
      - "25150:5150" #Only needed to for attaching for debug
    command: -simulator=ran-simulator:5150 -certPath=/etc/ssl/certs/ran-simulator.crt -keyPath=/etc/ssl/certs/ran-simulator.key -caPath=/etc/ssl/certs/onfca.crt
  ran-simulator:
    image: onosproject/ran-simulator:latest
    hostname: ran-simulator
    volumes:
      - type: bind
        source: ./ran-simulator/certs
        target: /etc/ssl/certs
    ports:
      - "15150:5150" #Only needed to for attaching for debug
    command: -googleAPIKey ${GOOGLE_API_KEY} -numLocations 100 -numRoutes 25 -stepDelayMs 2000 -certPath=/etc/ssl/certs/ran-simulator.crt -keyPath=/etc/ssl/certs/ran-simulator.key -caPath=/etc/ssl/certs/onfca.crt
  envoy-proxy:
    hostname: envoy-proxy
    ports:
      - "18080:8080" #Only needed for 'ng serve' development mode
      - "19901:9901"
    image: envoyproxy/envoy-alpine:v1.11.1
    volumes:
      - type: bind
        source: ./envoy-proxy
        target: /etc/envoy-proxy/
    command: /usr/local/bin/envoy -c /etc/envoy-proxy/envoy-proxy.yaml
  sd-ran-gui:
    image: onosproject/sd-ran-gui:latest
    hostname: sd-ran-gui
    environment:
      - GOOGLE_API_KEY=${GOOGLE_API_KEY}
    volumes:
      - type: bind
        source: ./sd-ran-gui
        target: /etc/nginx/conf.d
    ports:
      - "4200:80"
    labels:
      description: "ONOS SD RAN GUI"
